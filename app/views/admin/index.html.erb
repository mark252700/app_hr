<div class="container-fluid">
<h1>Employee List</h1>

<div class="d-flex justify-content-end mb-2"> <!-- Align to the right -->
  <div class="input-group input-group-sm" style="width: 350px;"> <!-- Adjust the width as needed -->
    <input type="text" class="form-control" placeholder="Search..." id="searchInput">
    <div class="input-group-append">
      <button class="btn btn-outline-secondary" type="button" id="searchButton">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </div>
</div>
<div class="table-responsive">
<table class="table table-hover table-lg">
  <thead>
    <tr>
      <th>Employee No.</th>
      <th>Email</th>
      <th>Full Name</th>
      <th>Role</th>
      <th>Submitted</th>
      <th>Benefits</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @users.each do |user| %>
      <tr class="user-row">
        <td><%= user.emp_detail&.emp_id %></td>
        <td><%= user.email %></td>
       
        <td><%= user.emp_detail&.fullname %></td>
         <td><%= user.role ? "Admin" : "Client" %></td>
          <td><%= user.submitted ? "Yes" : "No" %></td>
        <td>
          <!-- Display benefits for the emp_detail -->
          <ul class="<%= user.emp_detail && user.emp_detail.benefits.any? ? 'list-group list-group-blue' : 'list-group list-group-red' %>">
            <% if user.emp_detail && user.emp_detail.benefits.any? %>
              <% user.emp_detail.benefits.each do |benefit| %>
                <li class="list-group-item"><%= benefit.benefit %></li>
              <% end %>
            <% else %>
              <li class="list-group-item list-group-item-danger">No benefits found</li>
            <% end %>
          </ul>
        </td>
        <td>
         <%= link_to show_user_admin_user_management_path(user), class: "btn btn-info btn-sm", data: { turbo_frame: "show_user" } do %>
         <i class="fas fa-eye"></i> <!-- View icon -->
          <% end %>

          <%= link_to edit_admin_user_management_path(user), class: "btn btn-warning btn-sm", data: { turbo_frame: "user_modal" } do %>
            <i class="fas fa-edit"></i> <!-- Edit icon -->
          <% end %>

      <%= link_to admin_admin_path(user), method: :delete, data: { confirm: "Are you sure you want to cancel this form?" }, class: "btn btn-danger btn-sm" do %>
      <i class="fas fa-trash"></i> <!-- Delete icon -->
       <% end %>

        <%= link_to approve_user_admin_user_management_path(user), method: :patch, class: "btn btn-success btn-sm", onclick: "return showApprovalConfirmation();" do %>
         <i class="fas fa-check"></i> <!-- Approve icon -->
         <% end unless user.approved? %>

         
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

</div>
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item <%= @users.current_page == 1 ? 'disabled' : '' %>">
      <a class="page-link" href="<%= url_for(page: @users.current_page - 1) %>" aria-label="Previous">
        <span aria-hidden="true">Previous</span>
      </a>
    </li>
    <% (1..@users.total_pages).each do |page| %>
      <li class="page-item <%= page == @users.current_page ? 'active' : '' %>">
        <a class="page-link" href="<%= url_for(page: page) %>" aria-label="<%= page %>">
          <span aria-hidden="true"><%= page %></span>
        </a>
      </li>
    <% end %>
    <li class="page-item <%= @users.current_page == @users.total_pages ? 'disabled' : '' %>">
      <a class="page-link" href="<%= url_for(page: @users.current_page + 1) %>" aria-label="Next">
        <span aria-hidden="true">Next</span>
      </a>
    </li>
  </ul>
</nav>


<%= link_to "Register a User", new_admin_user_management_path, class: "btn btn-primary", data: { turbo_frame: "user_modal" } %>
<br>
<br>


</div>

<script>
// Get the input field and all user rows
var searchInput = document.getElementById("searchInput");
var userRows = document.querySelectorAll(".user-row");

// Add an event listener to the input field for keyup events
searchInput.addEventListener("keyup", function() {
  var searchText = searchInput.value.toLowerCase();

  // Iterate through all user rows
  for (var i = 0; i < userRows.length; i++) {
    var row = userRows[i];
    var cells = row.getElementsByTagName("td");
    var match = false;

    // Check each cell in the row for a match with the search text
    for (var j = 0; j < cells.length; j++) {
      var cell = cells[j];
      if (cell.textContent.toLowerCase().indexOf(searchText) > -1) {
        match = true;
        break; // Exit the loop if a match is found in this row
      }
    }

    // Show or hide the row based on the match
    if (match) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  }
});

</script>
